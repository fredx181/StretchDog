#Notify user of interface state changes

issue_notices()
{
	export LD_LIBRARY_PATH=/lib:/usr/lib:/usr/X11R7/lib:/root/my-applications/lib:/opt/samba/lib
	export DISPLAY=:0

	case "$reason" in
	BOUND|REBOOT|STATIC) #up
		if [[ $interface == `cat /etc/frisbee/interface` ]] ; then
			killall -SIGCONT network_tray
		else
			killall -SIGUSR1 network_tray
		fi
		touch /tmp/frisbee_iface-$interface
		 ;;
	RELEASE) #release
		if [[ $interface == `cat /etc/frisbee/interface` ]] ; then
			killall -SIGALRM network_tray
		fi
		 ;;
	NOCARRIER) #down
		if [[ $interface == `cat /etc/frisbee/interface` ]] ; then
			killall -SIGALRM network_tray
		else
			killall -SIGUSR2 network_tray
		fi
		rm -f /tmp/frisbee_iface-$interface
		 ;;
	esac

	WIFI_IF=`cat /etc/frisbee/interface 2>/dev/null`
	if [ -e /tmp/frisbee_iface-$WIFI_IF ] ; then
		killall -SIGCONT network_tray
	elif [[ `ls /tmp/frisbee_iface-* |wc -l` > 0 ]] ; then
		killall -SIGUSR1 network_tray
	fi
}


if echo "$reason" | grep -q -E 'BOUND|REBOOT|STATIC|RELEASE|NOCARRIER';then
	issue_notices
fi
[ -z "`pidof network_tray`" ] && network_tray &
